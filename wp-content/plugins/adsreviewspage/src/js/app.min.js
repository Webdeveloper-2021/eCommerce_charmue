jQuery((function($){Handlebars.registerHelper("ifCond",(function(v1,operator,v2,options){switch(operator){case"==":return v1==v2?options.fn(this):options.inverse(this);case"===":return v1===v2?options.fn(this):options.inverse(this);case"!=":return v1!=v2?options.fn(this):options.inverse(this);case"!==":return v1!==v2?options.fn(this):options.inverse(this);case"<":return v1<v2?options.fn(this):options.inverse(this);case"<=":return v1<=v2?options.fn(this):options.inverse(this);case">":return v1>v2?options.fn(this):options.inverse(this);case">=":return v1>=v2?options.fn(this):options.inverse(this);case"&&":return v1&&v2?options.fn(this):options.inverse(this);case"||":return v1||v2?options.fn(this):options.inverse(this);default:return options.inverse(this)}})),Handlebars.registerHelper("svgStars",(function(rating,opts){var styleRating=Handlebars.escapeExpression(this.styleRating);opts.hash.hasOwnProperty("styleRating")&&(styleRating=Handlebars.escapeExpression(opts.hash.styleRating));var html="";rating=rating.toString().split(".",2);for(var i=0;i<5;i++){var className="";rating[0]<=i&&(className="-o",rating[0]==i&&rating[1]&&rating[1]>3&&(className="-h")),html+='<svg viewBox="0 0 12 12" class=\'tr-star-color'+className+"'><use xlink:href=\"#rating-"+styleRating+'"></use></svg>'}return html})),window.TR={request:function(method,args=null,callback){args instanceof jQuery&&(args=args.serializeJSON()),$.ajax({url:arpAjax.URL,data:{action:arpAjax.ACTION,method:method,args:args},type:"POST",dataType:"json",success:callback})},objTotmpl:function(tmpl,data){return"undefined"==typeof Handlebars?(console.log("Handlebars not registry"),!1):Handlebars.compile(tmpl)(data);var template},render:function(tmpl,$target,res){res&&(res.hasOwnProperty("success")&&!res.success||(res.hasOwnProperty("message"),res.data&&(tmpl=$(tmpl).html(),$target instanceof jQuery||($target=$($target)),$target.html(this.objTotmpl(tmpl,res.data)))))}};var TRPreview={loadedStyle:function(res){(document.body.classList.contains("michelangelo")||document.body.classList.contains("davinci")||document.body.classList.contains("andy"))&&(document.documentElement.style.fontSize="13px"),document.body.classList.contains("theme-puca")&&(document.documentElement.style.fontSize="14px"),this._style=res.data,arpAjax.ATTS.readmore&&(this._style.readMore=$("<textarea />").html(arpAjax.ATTS.readmore).text()),this.fetch()},render:function(res){if(this.$target.find(".trp-loader").addClass("trp-loader-hidden"),this.offset=null,res.data.list.length){this._revie?this._revie=$.extend({},this._revie,res.data,{list:this._revie.list.concat(res.data.list)}):this._revie=res.data;var args=$.extend({},this._style,this._revie,{i18n:arpAjax.I18N});window.TR.render("#tmpl-trustpage",this.$target,{success:!0,data:args}),this._fetching=!1,this.list=document.querySelector(".trp-list"),this.$body.trigger("jetpack-lazy-images-load"),void 0!==window.Flatsome&&this.$target.find(".lazy-load:not(.lazy-load-active)").each((function(){var $element=$(this),src=$element.data("src"),srcset=$element.data("srcset");src&&$element.attr("src",src),srcset&&$element.attr("srcset",srcset),$element.addClass("lazy-load-active").removeClass("lazy-load")})),this._style&&"grids"===this._style.styleLayout&&(this.updateGrid(),this.$target.imagesLoaded(this.updateGrid.bind(this)))}},fetch:function(){this.paged++;var args={paged:this.paged};if(arpAjax.ATTS.limit){if(this.paged>1)return;args.limit=arpAjax.ATTS.limit}this._fetching=!0,this.$target.find(".trp-loader").removeClass("trp-loader-hidden"),window.TR.request("Reviews.get",args,this.render.bind(this))},update:function(){},updateGrid:function(){this.grid=new Minigrid({container:".trp-list-grids",item:".trp-list-item",rtl:"rtl"===document.dir}),this.offset=window.pageYOffset||window.scrollY,this.handlerResize()},handlerResize:function(){if(this.list){for(var i=2;i<6;i++){var classes="trp-list-grids-"+i;this.list.classList.remove(classes),this.list.clientWidth>=235*i&&this.list.classList.add(classes)}this.grid&&(this.grid.mount(),null!==this.offset&&this.offset>(window.pageYOffset||window.scrollY)&&(window.scrollTo(0,this.offset),this.offset=null))}},handlerScroll:function(event){var rect;this.list&&!this._fetching&&(this.list.getBoundingClientRect().bottom-2.5*window.innerHeight>0||this.fetch())},onLike:function(event){event.preventDefault();var $this=$(event.currentTarget);if(!$this.hasClass("active")){var $wrap=$this.closest("span"),$next,$next;if(window.TR.request("Reviews.like",{commentId:$wrap.attr("data-id")}),$active=$wrap.find(".active"),$active.length)$active.removeClass("active"),($next=$active.next()).text(1*$next.text()-1);$this.addClass("active"),($next=$this.next()).text(1*$next.text()+1)}},onDislike:function(event){event.preventDefault();var $this=$(event.currentTarget);if(!$this.hasClass("active")){var $wrap=$this.closest("span"),$next,$next;if(window.TR.request("Reviews.dislike",{commentId:$wrap.attr("data-id")}),$active=$wrap.find(".active"),$active.length)$active.removeClass("active"),($next=$active.next()).text(1*$next.text()-1);$this.addClass("active"),($next=$this.next()).text(1*$next.text()+1)}},onReloadItem:function(event){event.preventDefault();var $this=$(event.currentTarget);$this.hasClass("active")||($this.addClass("active"),window.TR.request("Reviews.update",{commentId:$this.attr("data-id")},this.onReloadItemUpd.bind(this)))},onReloadItemUpd:function(res){var $item=this.$target.find("#arp-review-"+res.data.comment_ID);$item.find(".trp-list-item-picture img").attr("src",res.data.photo),$item.find(".trp-list-item-usename-fullname").text(res.data.comment_author),$item.find(".trp-list-item-reload").removeClass("active")},handler:function(){window.addEventListener("resize",this.handlerResize.bind(this)),window.addEventListener("scroll",this.handlerScroll.bind(this)),this.$target.on("click",".trp-list-item-link-like",this.onLike.bind(this)),this.$target.on("click",".trp-list-item-link-dislike",this.onDislike.bind(this)),this.$target.on("click",".trp-list-item-reload",this.onReloadItem.bind(this)),$.fn.magnificPopup&&this.$target.on("click",".trp-list-item-images a",(function(e){e.preventDefault();var $this,$items=$(e.target).closest("div").find("a"),items=[];$items.each((function(k,el){items[items.length]={src:$(el).attr("href")}})),$.magnificPopup.open({items:items,gallery:{enabled:!0},type:"image",mainClass:"mfp-arp"})}))},init:function(){if(this.tmpl=document.body.querySelector("#tmpl-trustpage"),null!==this.tmpl)return this.$target=$("<div />",{id:"arp-trustpage",html:'<div class="trp-loader">'+arpAjax.I18N.Loading+"</div>"}),this.$body=$("body"),this.$loader=this.$target.find(".trp-loader"),$(this.tmpl).before(this.$target),this._style=null,this._revie=null,this.lightBox=null,this.paged=0,window.TR.request("Customize.get",null,this.loadedStyle.bind(this)),this.handler(),this}};$(document).ready((function(){TRPreview.init()}))}));